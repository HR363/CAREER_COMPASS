{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/USER/Desktop/25PROJO/CAREER_COMPASS/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport { Component, ViewChild } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nlet VideoCallComponent = class VideoCallComponent {\n  constructor(route, router, authService, mentorshipService, webSocketService) {\n    this.route = route;\n    this.router = router;\n    this.authService = authService;\n    this.mentorshipService = mentorshipService;\n    this.webSocketService = webSocketService;\n    this.session = null;\n    // WebRTC\n    this.peerConnection = null;\n    this.localStream = null;\n    // UI State\n    this.isMuted = false;\n    this.isVideoEnabled = true;\n    this.isRemoteStreamActive = false;\n    // Chat\n    this.chatMessages = [];\n    this.chatMessage = '';\n  }\n  ngOnInit() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const sessionId = _this.route.snapshot.paramMap.get('id');\n      if (sessionId) {\n        yield _this.loadSession(sessionId);\n        yield _this.initializeVideoCall();\n        _this.setupWebSocketListeners();\n      }\n    })();\n  }\n  ngOnDestroy() {\n    this.cleanup();\n  }\n  loadSession(sessionId) {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      _this2.mentorshipService.getSession(sessionId).subscribe({\n        next: session => {\n          _this2.session = session;\n          _this2.joinSession();\n        },\n        error: error => {\n          console.error('Error loading session:', error);\n          _this2.router.navigate(['/mentorship']);\n        }\n      });\n    })();\n  }\n  initializeVideoCall() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      try {\n        // Get user media\n        _this3.localStream = yield navigator.mediaDevices.getUserMedia({\n          video: true,\n          audio: true\n        });\n        // Set up local video\n        if (_this3.localVideo) {\n          _this3.localVideo.nativeElement.srcObject = _this3.localStream;\n        }\n        // Initialize peer connection\n        _this3.initializePeerConnection();\n      } catch (error) {\n        console.error('Error accessing media devices:', error);\n      }\n    })();\n  }\n  initializePeerConnection() {\n    const configuration = {\n      iceServers: [{\n        urls: 'stun:stun.l.google.com:19302'\n      }, {\n        urls: 'stun:stun1.l.google.com:19302'\n      }]\n    };\n    this.peerConnection = new RTCPeerConnection(configuration);\n    // Add local stream to peer connection\n    if (this.localStream) {\n      this.localStream.getTracks().forEach(track => {\n        this.peerConnection.addTrack(track, this.localStream);\n      });\n    }\n    // Handle remote stream\n    this.peerConnection.ontrack = event => {\n      const remoteStream = event.streams[0];\n      if (this.remoteVideo) {\n        this.remoteVideo.nativeElement.srcObject = remoteStream;\n        this.isRemoteStreamActive = true;\n      }\n    };\n    // Handle ICE candidates\n    this.peerConnection.onicecandidate = event => {\n      if (event.candidate && this.session) {\n        this.webSocketService.sendIceCandidate(this.session.roomId, event.candidate, 'remote-user' // This should be the actual remote user ID\n        );\n      }\n    };\n  }\n  setupWebSocketListeners() {\n    this.webSocketService.onWebRTCOffer(data => {\n      this.handleOffer(data.offer);\n    });\n    this.webSocketService.onWebRTCAnswer(data => {\n      this.handleAnswer(data.answer);\n    });\n    this.webSocketService.onIceCandidate(data => {\n      this.handleIceCandidate(data.candidate);\n    });\n    this.webSocketService.onChatMessage(data => {\n      this.chatMessages.push({\n        content: data.message,\n        isFromUser: data.fromUserId !== this.authService.getCurrentUser()?.id,\n        timestamp: new Date(data.timestamp)\n      });\n      this.scrollChatToBottom();\n    });\n  }\n  joinSession() {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      if (_this4.session) {\n        try {\n          yield _this4.webSocketService.joinRoom(_this4.session.roomId);\n        } catch (error) {\n          console.error('Error joining room:', error);\n        }\n      }\n    })();\n  }\n  handleOffer(offer) {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      if (_this5.peerConnection) {\n        yield _this5.peerConnection.setRemoteDescription(offer);\n        const answer = yield _this5.peerConnection.createAnswer();\n        yield _this5.peerConnection.setLocalDescription(answer);\n        if (_this5.session) {\n          _this5.webSocketService.sendWebRTCAnswer(_this5.session.roomId, answer, 'remote-user');\n        }\n      }\n    })();\n  }\n  handleAnswer(answer) {\n    var _this6 = this;\n    return _asyncToGenerator(function* () {\n      if (_this6.peerConnection) {\n        yield _this6.peerConnection.setRemoteDescription(answer);\n      }\n    })();\n  }\n  handleIceCandidate(candidate) {\n    var _this7 = this;\n    return _asyncToGenerator(function* () {\n      if (_this7.peerConnection) {\n        yield _this7.peerConnection.addIceCandidate(candidate);\n      }\n    })();\n  }\n  toggleMute() {\n    if (this.localStream) {\n      const audioTrack = this.localStream.getAudioTracks()[0];\n      if (audioTrack) {\n        audioTrack.enabled = !audioTrack.enabled;\n        this.isMuted = !audioTrack.enabled;\n      }\n    }\n  }\n  toggleVideo() {\n    if (this.localStream) {\n      const videoTrack = this.localStream.getVideoTracks()[0];\n      if (videoTrack) {\n        videoTrack.enabled = !videoTrack.enabled;\n        this.isVideoEnabled = videoTrack.enabled;\n      }\n    }\n  }\n  endCall() {\n    var _this8 = this;\n    return _asyncToGenerator(function* () {\n      if (_this8.session) {\n        yield _this8.mentorshipService.endSession(_this8.session.id).subscribe({\n          next: () => {\n            _this8.leaveSession();\n          },\n          error: error => {\n            console.error('Error ending session:', error);\n            _this8.leaveSession();\n          }\n        });\n      } else {\n        _this8.leaveSession();\n      }\n    })();\n  }\n  leaveSession() {\n    this.cleanup();\n    this.router.navigate(['/mentorship']);\n  }\n  sendChatMessage() {\n    if (this.chatMessage.trim() && this.session) {\n      this.webSocketService.sendChatMessage(this.session.roomId, this.chatMessage);\n      this.chatMessages.push({\n        content: this.chatMessage,\n        isFromUser: true,\n        timestamp: new Date()\n      });\n      this.chatMessage = '';\n      this.scrollChatToBottom();\n    }\n  }\n  scrollChatToBottom() {\n    setTimeout(() => {\n      if (this.chatContainer) {\n        this.chatContainer.nativeElement.scrollTop = this.chatContainer.nativeElement.scrollHeight;\n      }\n    }, 100);\n  }\n  cleanup() {\n    if (this.localStream) {\n      this.localStream.getTracks().forEach(track => track.stop());\n    }\n    if (this.peerConnection) {\n      this.peerConnection.close();\n    }\n    this.webSocketService.disconnect();\n  }\n};\n__decorate([ViewChild('localVideo')], VideoCallComponent.prototype, \"localVideo\", void 0);\n__decorate([ViewChild('remoteVideo')], VideoCallComponent.prototype, \"remoteVideo\", void 0);\n__decorate([ViewChild('chatContainer')], VideoCallComponent.prototype, \"chatContainer\", void 0);\nVideoCallComponent = __decorate([Component({\n  selector: 'app-video-call',\n  standalone: true,\n  imports: [CommonModule],\n  template: `\n    <div class=\"min-h-screen bg-secondary-900 flex flex-col\">\n      <!-- Header -->\n      <div class=\"bg-secondary-800 px-4 py-3 flex justify-between items-center\">\n        <div class=\"flex items-center space-x-4\">\n          <button (click)=\"leaveSession()\" class=\"text-white hover:text-secondary-300\">\n            <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 19l-7-7 7-7\"></path>\n            </svg>\n          </button>\n          <h1 class=\"text-white font-medium\">{{ session?.mentor?.name }} & {{ session?.student?.name }}</h1>\n        </div>\n        <div class=\"flex items-center space-x-2\">\n          <span class=\"text-secondary-300 text-sm\">{{ session?.status }}</span>\n          <div class=\"w-3 h-3 bg-green-500 rounded-full\"></div>\n        </div>\n      </div>\n\n      <!-- Video Container -->\n      <div class=\"flex-1 flex flex-col lg:flex-row\">\n        <!-- Main Video Area -->\n        <div class=\"flex-1 flex flex-col\">\n          <!-- Remote Video -->\n          <div class=\"flex-1 bg-secondary-800 flex items-center justify-center relative\">\n            <video #remoteVideo \n                   class=\"w-full h-full object-cover\"\n                   autoplay \n                   playsinline\n                   [class.hidden]=\"!isRemoteStreamActive\">\n            </video>\n            <div *ngIf=\"!isRemoteStreamActive\" class=\"text-center text-white\">\n              <div class=\"mb-4\">\n                <svg class=\"w-16 h-16 mx-auto text-secondary-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z\"></path>\n                </svg>\n              </div>\n              <p class=\"text-lg\">Waiting for other participant...</p>\n            </div>\n          </div>\n\n          <!-- Controls -->\n          <div class=\"bg-secondary-800 px-6 py-4 flex justify-center space-x-4\">\n            <button (click)=\"toggleMute()\" \n                    [class]=\"isMuted ? 'bg-red-600 hover:bg-red-700' : 'bg-secondary-700 hover:bg-secondary-600'\"\n                    class=\"p-3 rounded-full text-white transition-colors\">\n              <svg *ngIf=\"!isMuted\" class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z\"></path>\n              </svg>\n              <svg *ngIf=\"isMuted\" class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z\"></path>\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2\"></path>\n              </svg>\n            </button>\n\n            <button (click)=\"toggleVideo()\" \n                    [class]=\"!isVideoEnabled ? 'bg-red-600 hover:bg-red-700' : 'bg-secondary-700 hover:bg-secondary-600'\"\n                    class=\"p-3 rounded-full text-white transition-colors\">\n              <svg *ngIf=\"isVideoEnabled\" class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z\"></path>\n              </svg>\n              <svg *ngIf=\"!isVideoEnabled\" class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z\"></path>\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21\"></path>\n              </svg>\n            </button>\n\n            <button (click)=\"endCall()\" \n                    class=\"p-3 rounded-full bg-red-600 hover:bg-red-700 text-white transition-colors\">\n              <svg class=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 8l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M5 3a2 2 0 00-2 2v1c0 8.284 6.716 15 15 15h1a2 2 0 002-2v-3.28a1 1 0 00-.684-.948l-4.493-1.498a1 1 0 00-1.21.502l-1.13 2.257a11.042 11.042 0 01-5.516-5.517l2.257-1.128a1 1 0 00.502-1.21L9.228 3.684A1 1 0 008.279 3H5z\"></path>\n              </svg>\n            </button>\n          </div>\n        </div>\n\n        <!-- Sidebar -->\n        <div class=\"lg:w-80 bg-secondary-800 flex flex-col\">\n          <!-- Local Video -->\n          <div class=\"p-4 border-b border-secondary-700\">\n            <video #localVideo \n                   class=\"w-full h-32 object-cover rounded-lg\"\n                   autoplay \n                   playsinline \n                   muted\n                   [class.hidden]=\"!isVideoEnabled\">\n            </video>\n            <div *ngIf=\"!isVideoEnabled\" class=\"w-full h-32 bg-secondary-700 rounded-lg flex items-center justify-center\">\n              <span class=\"text-secondary-400 text-sm\">Camera off</span>\n            </div>\n          </div>\n\n          <!-- Chat -->\n          <div class=\"flex-1 flex flex-col\">\n            <div class=\"p-4 border-b border-secondary-700\">\n              <h3 class=\"text-white font-medium\">Chat</h3>\n            </div>\n            \n            <div class=\"flex-1 p-4 overflow-y-auto\" #chatContainer>\n              <div *ngFor=\"let message of chatMessages\" class=\"mb-3\">\n                <div [ngClass]=\"message.isFromUser ? 'text-right' : 'text-left'\">\n                  <div [ngClass]=\"message.isFromUser ? 'bg-primary-600' : 'bg-secondary-700'\"\n                       class=\"inline-block px-3 py-2 rounded-lg text-white text-sm max-w-xs\">\n                    {{ message.content }}\n                  </div>\n                  <div class=\"text-xs text-secondary-400 mt-1\">\n                    {{ message.timestamp | date:'h:mm a' }}\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div class=\"p-4 border-t border-secondary-700\">\n              <div class=\"flex space-x-2\">\n                <input type=\"text\" \n                       [(ngModel)]=\"chatMessage\"\n                       (keydown.enter)=\"sendChatMessage()\"\n                       placeholder=\"Type a message...\"\n                       class=\"flex-1 px-3 py-2 bg-secondary-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500\">\n                <button (click)=\"sendChatMessage()\"\n                        class=\"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700\">\n                  Send\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  `,\n  styles: []\n})], VideoCallComponent);\nexport { VideoCallComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}