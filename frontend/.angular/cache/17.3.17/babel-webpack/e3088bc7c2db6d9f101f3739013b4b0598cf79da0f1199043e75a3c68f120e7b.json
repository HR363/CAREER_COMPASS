{"ast":null,"code":"import { io } from 'socket.io-client';\nimport { environment } from '../../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./auth.service\";\nexport let WebSocketService = /*#__PURE__*/(() => {\n  class WebSocketService {\n    constructor(authService) {\n      this.authService = authService;\n      this.socket = null;\n    }\n    connect() {\n      const token = this.authService.getToken();\n      if (!token) {\n        console.error('No authentication token available');\n        return;\n      }\n      this.socket = io(environment.apiUrl, {\n        auth: {\n          token: token\n        }\n      });\n      this.socket.on('connect', () => {\n        console.log('Connected to WebSocket server');\n      });\n      this.socket.on('disconnect', () => {\n        console.log('Disconnected from WebSocket server');\n      });\n      this.socket.on('connect_error', error => {\n        console.error('WebSocket connection error:', error);\n      });\n    }\n    disconnect() {\n      if (this.socket) {\n        this.socket.disconnect();\n        this.socket = null;\n      }\n    }\n    joinRoom(roomId) {\n      return new Promise((resolve, reject) => {\n        if (!this.socket) {\n          reject(new Error('Socket not connected'));\n          return;\n        }\n        this.socket.emit('join-room', {\n          roomId\n        }, response => {\n          if (response.error) {\n            reject(new Error(response.error));\n          } else {\n            resolve(response);\n          }\n        });\n      });\n    }\n    leaveRoom(roomId) {\n      return new Promise((resolve, reject) => {\n        if (!this.socket) {\n          reject(new Error('Socket not connected'));\n          return;\n        }\n        this.socket.emit('leave-room', {\n          roomId\n        }, response => {\n          if (response.error) {\n            reject(new Error(response.error));\n          } else {\n            resolve(response);\n          }\n        });\n      });\n    }\n    sendWebRTCOffer(roomId, offer, targetUserId) {\n      return new Promise((resolve, reject) => {\n        if (!this.socket) {\n          reject(new Error('Socket not connected'));\n          return;\n        }\n        this.socket.emit('webrtc-offer', {\n          roomId,\n          offer,\n          targetUserId\n        }, response => {\n          if (response.error) {\n            reject(new Error(response.error));\n          } else {\n            resolve(response);\n          }\n        });\n      });\n    }\n    sendWebRTCAnswer(roomId, answer, targetUserId) {\n      return new Promise((resolve, reject) => {\n        if (!this.socket) {\n          reject(new Error('Socket not connected'));\n          return;\n        }\n        this.socket.emit('webrtc-answer', {\n          roomId,\n          answer,\n          targetUserId\n        }, response => {\n          if (response.error) {\n            reject(new Error(response.error));\n          } else {\n            resolve(response);\n          }\n        });\n      });\n    }\n    sendIceCandidate(roomId, candidate, targetUserId) {\n      return new Promise((resolve, reject) => {\n        if (!this.socket) {\n          reject(new Error('Socket not connected'));\n          return;\n        }\n        this.socket.emit('webrtc-ice-candidate', {\n          roomId,\n          candidate,\n          targetUserId\n        }, response => {\n          if (response.error) {\n            reject(new Error(response.error));\n          } else {\n            resolve(response);\n          }\n        });\n      });\n    }\n    sendChatMessage(roomId, message) {\n      return new Promise((resolve, reject) => {\n        if (!this.socket) {\n          reject(new Error('Socket not connected'));\n          return;\n        }\n        this.socket.emit('chat-message', {\n          roomId,\n          message\n        }, response => {\n          if (response.error) {\n            reject(new Error(response.error));\n          } else {\n            resolve(response);\n          }\n        });\n      });\n    }\n    // Event listeners\n    onUserJoined(callback) {\n      if (this.socket) {\n        this.socket.on('user-joined', callback);\n      }\n    }\n    onUserLeft(callback) {\n      if (this.socket) {\n        this.socket.on('user-left', callback);\n      }\n    }\n    onWebRTCOffer(callback) {\n      if (this.socket) {\n        this.socket.on('webrtc-offer', callback);\n      }\n    }\n    onWebRTCAnswer(callback) {\n      if (this.socket) {\n        this.socket.on('webrtc-answer', callback);\n      }\n    }\n    onIceCandidate(callback) {\n      if (this.socket) {\n        this.socket.on('webrtc-ice-candidate', callback);\n      }\n    }\n    onChatMessage(callback) {\n      if (this.socket) {\n        this.socket.on('chat-message', callback);\n      }\n    }\n    // Remove event listeners\n    offUserJoined(callback) {\n      if (this.socket) {\n        this.socket.off('user-joined', callback);\n      }\n    }\n    offUserLeft(callback) {\n      if (this.socket) {\n        this.socket.off('user-left', callback);\n      }\n    }\n    offWebRTCOffer(callback) {\n      if (this.socket) {\n        this.socket.off('webrtc-offer', callback);\n      }\n    }\n    offWebRTCAnswer(callback) {\n      if (this.socket) {\n        this.socket.off('webrtc-answer', callback);\n      }\n    }\n    offIceCandidate(callback) {\n      if (this.socket) {\n        this.socket.off('webrtc-ice-candidate', callback);\n      }\n    }\n    offChatMessage(callback) {\n      if (this.socket) {\n        this.socket.off('chat-message', callback);\n      }\n    }\n    static {\n      this.ɵfac = function WebSocketService_Factory(t) {\n        return new (t || WebSocketService)(i0.ɵɵinject(i1.AuthService));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: WebSocketService,\n        factory: WebSocketService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return WebSocketService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}